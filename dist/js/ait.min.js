/*! astrox-imperium-tools v0.0.1 | (c) 2019  | MIT License | git+https://github.com/sharpshifter/ait.git */
/*!
 * astrox-imperium-tools v0.0.1
 * Various tools to do various things for the game Astrox Imperium
 * (c) 2019 
 * MIT License
 * git+https://github.com/sharpshifter/ait.git
 */
!(function(e,a,t){var r={buttons:"bold,italic,underline,strike,code,spoiler,line,quote,|,img,video,link,|,bullist,numlist,|,fontcolor,fontsize,fontfamily,|,justifyleft,justifycenter,justifyright,|,removeFormat",allButtons:{spoiler:{title:"Insert spoiler",buttonText:"spoiler",transform:{'<div class="spoiler">{SELTEXT}</div>':"[spoiler]{SELTEXT}[/spoiler]"}},line:{title:"Insert horizontal rule/line",buttonText:"line",transform:{"{SELTEXT}\n<hr>":"{SELTEXT}\n[line]"}}},autoresize:!1,resize_maxheight:400};function s(e){return e=e.replace(/[^\s]+/g,(function(e){return e.replace(/^./,(function(e){return e.toUpperCase()}))}))}function i(e){var a="",t=e.replace("_lifesupport","_life_support");t=(t=(t=(t=(t=(t=t.replace("ls_food","life_support_food")).replace("ls_water","life_support_water")).replace("ls_thermal","life_support_thermal")).replace("ls_waste","life_support_waste")).replace("specials_raw","special_attributes")).split("_");for(var r=0;r<t.length;r++)a+=r>0?" "+s(t[r]):s(t[r]);return a}function n(t){var r="";if("specials_raw"==t[1]){for(var s=[];null!=(match=e.shipDataExporter.shipSpecialsPattern.exec(t[2]));)s.push(match);a.each(s,(function(a,t){r+=t[1]+e.shipDataExporter.templateTagsSeparator+(function(e){var a;a=isNaN(e)?e:(100*parseFloat(e)).toString()+"%";return a})(t[2])+"\n"}))}else r=t[2];return r}window.dataLayer=window.dataLayer||[],e.showNotification=function(e,t="add_alert",r="info"){a.notify({icon:t,message:e},{type:r,delay:3500,timer:1e3,placement:{from:"top",align:"center"}})};var p=a("#shipdataexporter_sourcedata"),o=a("#shipdataexporter_process"),l=a("#shipdataexporter_sourcelabels"),c=a("#shipdataexporter_template"),u=a("#shipdataexporter_labelsandtemplate"),h=(a("#shipdataexporter_usedefaulttemplatelabels"),a("#shipdataexporter_modewarning")),d=(a("#shipdataexporter_generateoutput"),a("#modal_shipdataexporter_output")),m=a("#shipdataexporter_outputarea"),g=a("#shipdataexporter_copytoclipboard");e.shipDataExporter={editorType:"wysibb",wysibbInBBCodeMode:!1,templateTagsSeparator:": ",currentShipDataString:"",currentShipDataArray:[{}],shipInfoInputPattern:new RegExp(/SHIP_([^;]+);(.*)/g),shipInfoOutputPattern:new RegExp(/{([^\|\*]+)\|\*(\w+)}/g),shipSpecialsPattern:new RegExp(/([^\#]+)\#([^\,]+)\,*/g),tagWatcherInterval:null,footnoteBBCode:"[line]\n[size=1]Friendly details generated with [url=https://sharpshifter.net/ait/ship-info-exporter.html?ref=bb]AIT: Ship Info Exporter[/url][/size]\n",init:function(){if(p.on("change keyup paste",(function(){p.val().length?o.removeClass("disabled"):o.addClass("disabled")})),g.length){var a=new ClipboardJS(g[0]);a.on("success",(function(a){e.showNotification("Successfully copied code to clipboard!","done","success")})),a.on("error",(function(a){e.showNotification("Unable to copy code to clipboard","error_outline","danger")}))}},startProcess:function(){if(e.shipDataExporter.currentShipDataString=p.val(),e.shipDataExporter.currentShipDataString.length)if(-1!==e.shipDataExporter.currentShipDataString.indexOf("SHIP_")){var t;for(e.shipDataExporter.currentShipDataArray=[];null!=(t=e.shipDataExporter.shipInfoInputPattern.exec(e.shipDataExporter.currentShipDataString));)e.shipDataExporter.currentShipDataArray.push(t);if(e.shipDataExporter.currentShipDataArray.length){switch(e.shipDataExporter.currentShipDataArray.sort(),l.empty(),l.append(h),a.each(e.shipDataExporter.currentShipDataArray,(function(e,a){var t='<span class="badge badge-light" data-itemtag="'+a[1]+'">'+i(a[1])+"</span> ";l.append(t)})),e.showNotification("Successfully processed ship data","done","success"),u.removeClass("d-none"),e.shipDataExporter.editorType){case"wysibb":c.wysibb(r);break;default:e.showNotification("Please choose a template format first!","error_outline","danger")}a("html, body").animate({scrollTop:u.offset().top-20},350),null==e.shipDataExporter.tagWatcherInterval&&(e.shipDataExporter.tagWatcherInterval=setInterval(e.shipDataExporter.initTagWatcher,500))}else e.showNotification("Unable to process source ship data","error_outline","danger")}else e.showNotification("The source data doesn't seem to contain any ship stats","warning","warning")},initTagWatcher:function(){var t=e.shipDataExporter.getEditorOutput();a("span.badge[data-itemtag]").each((function(){a(this).removeClass("badge-light").removeClass("badge-secondary").removeClass("badge-primary").removeClass("badge-success");var e=a(this).data("itemtag"),r=!1,s=!1;-1!=t.indexOf("{"+e+"|*name}")&&(r=!0),-1!=t.indexOf("{"+e+"|*value}")&&(s=!0),r&&s?a(this).addClass("badge-secondary"):r?a(this).addClass("badge-primary"):s?a(this).addClass("badge-success"):a(this).addClass("badge-light")}))},insertTag:function(t,r){if(!l.find("#shipdataexporter_modewarning").is(":visible")){var s=a(r).data("itemtag");if(t.shiftKey)switch(e.shipDataExporter.editorType){case"wysibb":c.insertAtCursor(c.val()+"{"+s+"|*name}");break;default:c.val(c.val()+"{"+s+"|*name}")}else if(t.altKey)switch(e.shipDataExporter.editorType){case"wysibb":c.insertAtCursor(c.val()+"{"+s+"|*value}");break;default:c.val(c.val()+"{"+s+"|*value}")}else switch(e.shipDataExporter.editorType){case"wysibb":c.insertAtCursor(c.val()+"{"+s+"|*name}"+e.shipDataExporter.templateTagsSeparator+"{"+s+"|*value}");break;default:c.val(c.val()+"{"+s+"|*name}"+e.shipDataExporter.templateTagsSeparator+"{"+s+"|*value}")}}},doWysibbMode:function(a){e.shipDataExporter.wysibbInBBCodeMode=a,a?l.addClass("blurred").find("#shipdataexporter_modewarning").show():l.removeClass("blurred").find("#shipdataexporter_modewarning").hide()},useDefaultTemplate:function(){switch(e.shipDataExporter.editorType){case"wysibb":if(e.shipDataExporter.wysibbInBBCodeMode){var a="[b][size=3]{name|*value}[/size][/b]\n\n[img]https://via.placeholder.com/600x400.png?text=Placeholder+image+-+click+and+change+via+Image+icon[/img]\n\n[b][size=3]Primary Ship Details[/size][/b]\n{type|*name}"+e.shipDataExporter.templateTagsSeparator+"{type|*value}\n{class|*name}"+e.shipDataExporter.templateTagsSeparator+"{class|*value}\n{manufacturer|*name}"+e.shipDataExporter.templateTagsSeparator+"{manufacturer|*value}\n{active_slots|*name}"+e.shipDataExporter.templateTagsSeparator+"{active_slots|*value}\n{passive_slots|*name}"+e.shipDataExporter.templateTagsSeparator+"{passive_slots|*value}\n{base_price|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_price|*value}\n\n[b][size=3]Base Attributes[/size][/b]\n{base_shield|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_shield|*value}\n{base_energy|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_energy|*value}\n{impact_resistance|*name}"+e.shipDataExporter.templateTagsSeparator+"{impact_resistance|*value}\n{energy_resistance|*name}"+e.shipDataExporter.templateTagsSeparator+"{energy_resistance|*value}\n{explosive_resistance|*name}"+e.shipDataExporter.templateTagsSeparator+"{explosive_resistance|*value}\n\n{base_engine_burn|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_engine_burn|*value}\n{base_recharge|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_recharge|*value}\n{base_turn|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_turn|*value}\n{base_thrust|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_thrust|*value}\n{base_mass|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_mass|*value}\n\n{base_cargo|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_cargo|*value}\n{base_lifesupport|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_lifesupport|*value}\n\n{base_scan_speed|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_scan_speed|*value}\n{base_scan_max_targets|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_scan_max_targets|*value}\n{base_scan_pulserange|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_scan_pulserange|*value}\n{base_scan_pulsespeed|*name}"+e.shipDataExporter.templateTagsSeparator+"{base_scan_pulsespeed|*value}\n\n[b][size=3]{specials_raw|*name}[/size][/b]\n{specials_raw|*value}\n";c.bbcode(a),c.val(a),c.sync()}else e.showNotification("Please switch the editor to BBCode mode first","warning","warning");break;default:c.val(c.val()+"{"+itemTag+"|*value}")}},generateOutput:function(){for(var t,r=e.shipDataExporter.getEditorOutput(),s=[];null!=(t=e.shipDataExporter.shipInfoOutputPattern.exec(r));)s.push(t);switch(a.each(s,(function(a,t){var s="{"+t[1]+"|*"+t[2]+"}",p=e.shipDataExporter.currentShipDataArray.find(e=>e[1]===t[1]);null!=p?"name"==t[2]?r=r.replace(s,i(p[1])):"value"==t[2]&&(r=r.replace(s,n(p))):r=(r=(r=r.replace(s+e.shipDataExporter.templateTagsSeparator,"")).replace(s+"\n","")).replace(s,"")})),e.shipDataExporter.editorType){case"wysibb":r+=e.shipDataExporter.footnoteBBCode}m.val(r),d.modal("show")},getEditorOutput:function(){var a;switch(e.shipDataExporter.editorType){case"wysibb":a=c.bbcode();break;default:a="Editor not set!"}return a}},a((function(){p.length&&e.shipDataExporter.init(),l.on("click","span.badge",(function(a){e.shipDataExporter.insertTag(a,this)})),a(".main-panel .content").on("click","button",(function(){window.dataLayer.push({event:"contentButtonClicked",elementText:a(this).text(),elementID:a(this).attr("id")})})),a(".modal").on("click","button",(function(){window.dataLayer.push({event:"modalButtonClicked",elementText:a(this).text(),elementID:a(this).attr("id")})}))}))})(window.ait=window.ait||{},jQuery);